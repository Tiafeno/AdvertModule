"use strict";dashboard.config(["$routeProvider",function(a){a.when("/profil",{templateUrl:jsDashboard.partials_uri+"dashboard.profil.html",controller:"Dashboard_ProfilCtrl"}).when("/profil/edit",{templateUrl:jsDashboard.partials_uri+"dashboard.edit.html",controller:"Dashboard_EditCtrl",controllerAs:"EditCtrl"}).when("/timeline",{templateUrl:jsDashboard.partials_uri+"dashboard.timeline.html",controller:"Dashboard_TimelineCtrl"}).otherwise({redirectTo:"/profil/edit"})}]);var routeDashboard=angular.module("routeDashboard",[]);routeDashboard.filter("fromNow",function(){return function(a){var b=a.trim();return"undefined"==typeof moment?b+" - moment.js not define":(moment.locale("fr"),moment(b).fromNow())}}),routeDashboard.directive("uploadavatar",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(a){angular.element("#fileInput").trigger("click")})}}}).directive("ngUpload",function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.ngUpload);b.bind("change",d)}}}).directive("logout",function(){return{restrict:"A",scope:{},controller:function(a,b){a.redirectURL=function(c){b.location.href=c,a.$apply()}},link:function(a,b,c){b.bind("click",function(){var b=jsDashboard.logout_url;a.redirectURL(b)})}}}),routeDashboard.factory("factoryRouteDashboard",function(a,b,c){return{getUser:function(){return jsDashboard._user},get_nonce_field:function(b){return a.get(jsDashboard.ajax_url,{params:{action:"action_render_nonce",fieldnonce:b}})},verifyPassword:function(c){return a.get(jsDashboard.ajax_url,{params:{pass:b.btoa(c),action:"action_verify_password"}})},$httpPostForm:function(b){return a({url:jsDashboard.ajax_url,method:"POST",headers:{"Content-Type":void 0},data:b})}}}),routeDashboard.controller("Dashboard_EditCtrl",function(a,b,c){a._user=c.getUser(),a.progress={},a.profil={},a.verifyPassword=!0,a.nonce=null,a.progress.avatar=!0,a.progress.password_change=!0,function(){var b=_.keys(a._user);b=_.without(b,"id_user","id_advert_user"),_.each(b,function(b,c){a.profil[b]=a._user[b]}),null!=a.profil.img_url&&!1!==a.profil.img_url||(a.profil.img_url=jsDashboard.assets_plugins_url+"img/no-avatar-male.jpg")}(),a.EventSubmit=function(d){var e=new FormData,f=_.omit(a.profil,["id_user","img_url","id_advert_user"]);e.append("action","action_update_dashboard"),_.each(f,function(a,b){e.append(b,a.trim())}),c.get_nonce_field("update_profil_nonce").then(function(a){if(void 0==a.data.nonce)return console.warn("Missing nonce!"),!1;e.append("inputNonce",a.data.nonce),c.$httpPostForm(e).then(function(a){var c=a.data;void 0!=c.reload&&c.reload&&b.setTimeout(function(){location.reload()},1500)},function(a){console.warn(a)})})},a.EventformProfilValidate=function(b){return!(a.profilForm.$dirty&&a.profilForm.$valid||a.profilForm.$invalid&&!a.profilForm.$dirty)},a.EventVerifyPassword=function(a,b){c.verifyPassword(b.old_password.$modelValue).then(function(a){var c=a.data,d=!(!c.type||!c.token);b.old_password.$setValidity("verifyPassword",d)})},a.EventEqualsPassword=function(a,b){var c=b.new_password.$modelValue,d=b.confirm_password.$modelValue,e=c==d;b.confirm_password.$setValidity("equalsPassword",e)},a.EventTypePassword=function(a,b){var c=b.old_password.$modelValue,d=b.new_password.$modelValue,e=c!=d;void 0!=b.old_password.$modelValue&&b.new_password.$setValidity("oldEqualnew",e)},a.EventPassword=function(b,c){void 0!=c.confirm_password.$modelValue&&a.EventEqualsPassword(b,c)},a.EventClickchangeAvatar=function(){var b=event.target.files,d=new FormData;d.append("action","action_upload_avatar"),angular.forEach(b,function(a,b){d.append("file",a)}),a.progress.avatar=!1,c.get_nonce_field("avatar_upload").then(function(b){var e=b.data;a.nonce=e.nonce,d.append("nonce",a.nonce),c.$httpPostForm(d).then(function(b){var c=b.data;a.progress.avatar=!0,angular.element("#fileInput").val(""),c.type?a.profil.img_url=c.url:console.debug(c)},function(b){a.progress.avatar=!0,console.debug(b)})})},a.EventChangePassword=function(d){if(!d)return!1;a.progress.password_change=!1;var e=new FormData;e.append("action","action_change_password"),e.append("pass",b.btoa(a.new_password)),c.$httpPostForm(e).then(function(c){var d=c.data;d.type||console.debug(d.data),a.passwordForm.$setUntouched(),a.passwordForm.$setPristine(),b.setTimeout(function(){location.reload()},1500)},function(b){a.EventChangePassword(!0)})}}),routeDashboard.controller("Dashboard_ProfilCtrl",function(a){}),routeDashboard.controller("Dashboard_TimelineCtrl",function(a){});