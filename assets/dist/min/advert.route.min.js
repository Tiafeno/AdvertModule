"use strict";advert.config(["$routeProvider",function(a){a.when("/advert",{templateUrl:jsRoute.partials_uri+"advert-lists.html",controller:"AdvertController"}).when("/advert/:id",{templateUrl:jsRoute.partials_uri+"advert-details.html",controller:"AdvertDetails"}).when("/advert/:id/edit",{templateUrl:jsRoute.partials_uri+"advert-edit.html",controller:"AdvertEdit"}).when("/advert/:id/contact",{templateUrl:jsRoute.partials_uri+"advert-contact.html",controller:"AdvertContactEmail"}).when("/advert/:id/putforward",{templateUrl:jsRoute.partials_uri+"advert-putforward.html",controller:"putForward"}).when("/restricted",{templateUrl:jsRoute.partials_uri+"restricted.html",controller:"AdvertRestricted"}).when("/error/:code",{templateUrl:jsRoute.partials_uri+"error.html",controller:"AdvertError"}).otherwise({redirectTo:"/advert"})}]);var routeAdvert=angular.module("routeAdvert",["ngAlertify","ngSanitize","angularTrix"]);routeAdvert.controller("AdvertRestricted",function(a){}),routeAdvert.controller("AdvertError",function(a,b){a.errorCode=parseInt(b.code)}),routeAdvert.controller("AdvertEdit",function(a,b,c,d,e,f){var g=this,h=b.getDetails();a.showLoading=!0,a.products={},a.product_id=parseInt(c.id),a.submitEditForm=function(b){if(!b)return!1;f.getNonce("update_product_nonce").then(function(b){var c=new FormData,d=b.data.nonce;if(c.append("action","action_update_product"),c.append("inputTitle",a.products.post_title),c.append("inputContent",a.products.post_content),c.append("inputState",a.products.state),c.append("inputAdress",a.products.adress),c.append("inputPhone",a.products.phone),c.append("post_id",a.products.ID),_.isEmpty(d))return console.warn("Nonce variable is empty"),!1;c.append("inputNonce",d),f.xhrHttp(c).then(function(){e.success("Advert update with success")},function(a){e.error(a)})})},a.__set=function(b){void 0==b.attributs&&console.warn("Property `attributs` is undefined"),a.products.attributs=b.attributs,_.each(b.post,function(b,c){a.products[c]=b}),a.showLoading=!1},g.Initialize=function(){if(b.isAuthorize())_.isEmpty(h)?f.getProduct(a.product_id).then(function(b){a.__set(b.data.data)}).catch():a.__set(h);else{var c=new FormData;c.append("action","action_edit_post_verify"),c.append("post_id",a.product_id),f.xhrHttp(c).then(function(a){a.data.authorized?(b.authorizeAccess(),g.Initialize()):(b.deniedAccess(),d.path("/restricted"))},function(a){console.warn(a)})}},g.Initialize()}),routeAdvert.controller("AdvertContactEmail",function(a,b,c,d,e,f){a.Error=null,a.mail={},a.product_id=parseInt(d.id),a.product_details=c.getDetails(),isNaN(a.product_id)&&(a.Error="Id parameter isn't int variable type"),a.sendMail=function(c){if(c){var d=new FormData;d.append("action","action_send_mail"),d.append("post_id",a.product_id),d.append("senderName",a.mail.senderName),d.append("sender",a.mail.sender),d.append("message",a.mail.message),e.xhrHttp(d).then(function(c){var d=c.data;void 0!=c.status&&200==c.status&&(d.send?(a.mail={},f.alert(d.data,function(c){c.preventDefault(),a.$apply(function(){b.path("/advert/"+a.product_id)})})):f.alert(d.error,function(a){a.preventDefault()}))},function(a){console.warn(a)})}},_.isNull(a.Error)&&_.isEmpty(a.product_details)&&e.getProduct(a.product_id).then(function(b){var d=b.data;d.type?(a.product_details=d.data,c.setDetails(a.product_details)):console.warn(d.data)})}),routeAdvert.controller("AdvertDetails",function(a,b,c,d,e,f,g){(function(){var b=new FormData;b.append("action","action_edit_post_verify"),b.append("post_id",a.product_id),f.xhrHttp(b).then(function(a){a.data.authorized?e.authorizeAccess():e.deniedAccess(a.data.error)})})(),a.product_id=parseInt(c.id),a.refer=0,a.showLoading=!0,a.product_details={},isNaN(a.product_id)||f.getProduct(a.product_id).then(function(b){a.showLoading=!1;var c=b.data;if(c.type){a.product_details=c.data,e.setDetails(a.product_details);var d=a.product_details.post.pictures;_.isEmpty(d)||jQuery(".advert-slider").find(".advert-bg").css({background:"#151515 url( "+d[0].full+" )"})}else console.warn(c.data)}).catch(function(){}),a.EventClickSlide=function(b){a.refer=parseInt(b)},a.EventviewPhoneNumber=function(b){var c=a.product_details.post.phone,d=angular.element(numberView);parseInt(a.product_details.post.hidephone)?g.alert("Numero de telephone n'est pas disponible",function(a){a.preventDefault()}):d.html(c)},a.EventdeletePost=function(c){var h=new FormData;g.okBtn("Oui").cancelBtn("Non").confirm("Voulez vous vraiment supprimer cette annonce",function(c){c.preventDefault(),e.isAuthorize()?(h.append("action","action_delete_product"),h.append("post_id",a.product_id),f.xhrHttp(h).then(function(c){c.data.type&&g.success("Advert delete with success"),adverts.posts=_.reject(adverts.posts,function(b){return b.ID==a.product_id}),b.setTimeout(function(){a.$apply(function(){d.path("/advert")})},2500)},function(a){console.warn(a)})):g.alert(e.getDeniedMessage(),function(a){a.preventDefault()})},function(a){a.preventDefault()})}}).filter("moment",function(){return function(a){var b=a,c=moment(b);return c.tz("Europe/Kirov"),moment.locale("fr"),c.startOf("day").fromNow()+", le "+c.format("Do MMMM YYYY, h:mm ")}});